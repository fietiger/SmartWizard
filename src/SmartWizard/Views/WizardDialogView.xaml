<UserControl
    x:Class="SmartWizard.Views.WizardDialogView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:SmartWizard.Converters"
    xmlns:controls="clr-namespace:SmartWizard.Controls"
    xmlns:prism="http://prismlibrary.com/"
    xmlns:vm="clr-namespace:SmartWizard.ViewModels"
    Width="600"
    Height="450"
    prism:ViewModelLocator.AutoWireViewModel="True">

    <UserControl.Resources>
        <Style x:Key="WizardButtonStyle" TargetType="Button">
            <Setter Property="MinWidth" Value="80" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Margin" Value="5,0" />
            <Setter Property="Padding" Value="16,0" />
        </Style>

        <Style x:Key="StepIndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="CornerRadius" Value="15" />
            <Setter Property="Background" Value="LightGray" />
            <Setter Property="Margin" Value="5,0" />
        </Style>

        <Style
            x:Key="ActiveStepIndicatorStyle"
            BasedOn="{StaticResource StepIndicatorStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="#007ACC" />
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  标题栏  -->
        <Border
            Grid.Row="0"
            Padding="20,15"
            Background="#F5F5F5">
            <TextBlock
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="#333"
                Text="{Binding Title}" />
        </Border>

        <!--  步骤指示器  -->
        <Border
            Grid.Row="1"
            Padding="20,15"
            Background="White"
            BorderBrush="#E0E0E0"
            BorderThickness="0,0,0,1">
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="14"
                    FontWeight="SemiBold">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="步骤 {0} / {1}: {2}">
                            <Binding Converter="{x:Static local:IndexConverter.Instance}" Path="CurrentStepIndex" />
                            <Binding Path="Steps.Count" />
                            <Binding FallbackValue="向导步骤" Path="CurrentStep.Title" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </StackPanel>
        </Border>

        <!--  步骤内容区域  -->
        <Border
            Grid.Row="2"
            Padding="30"
            Background="White">
            <Grid>
                <controls:WizardStepContentPresenter Content="{Binding CurrentStep}" />
                <!--  调试信息  -->
                <StackPanel
                    Margin="10"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Background="LightYellow"
                    Orientation="Vertical"
                    Visibility="Hidden">
                    <TextBlock FontSize="10" Text="{Binding Steps.Count, StringFormat='Steps Count: {0}'}" />
                    <TextBlock FontSize="10" Text="{Binding CurrentStepIndex, StringFormat='Current Index: {0}'}" />
                    <TextBlock FontSize="10" Text="{Binding CurrentStep, StringFormat='Current Step: {0}', FallbackValue='CurrentStep is NULL'}" />
                    <TextBlock FontSize="10" Text="{Binding CurrentStep.Title, StringFormat='Current Title: {0}', FallbackValue='No Title'}" />
                    <TextBlock FontSize="10" Text="{Binding CurrentStep.IsValid, StringFormat='Is Valid: {0}', FallbackValue='No Step'}" />
                </StackPanel>
            </Grid>
        </Border>

        <!--  按钮栏  -->
        <Border
            Grid.Row="3"
            Padding="20,15"
            Background="#F8F8F8"
            BorderBrush="#E0E0E0"
            BorderThickness="0,1,0,0">
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    Command="{Binding CancelCommand}"
                    Content="取消"
                    Style="{StaticResource WizardButtonStyle}" />
                <Button
                    Command="{Binding GoBackCommand}"
                    Content="上一步"
                    Style="{StaticResource WizardButtonStyle}" />
                <Button
                    Command="{Binding GoNextCommand}"
                    Content="{Binding NextButtonText}"
                    IsDefault="True">
                    <Button.Style>
                        <Style BasedOn="{StaticResource WizardButtonStyle}" TargetType="Button">
                            <Setter Property="Background" Value="#007ACC" />
                            <Setter Property="Foreground" Value="White" />
                            <Setter Property="BorderBrush" Value="#007ACC" />
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>